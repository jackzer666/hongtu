# 正向代理与反向代理

## 正向代理

客户端访问某个服务器，无法直接访问，从而找个代理服务器，先访问代理服务器，代理服务器可以访问到目标服务器。

正向代理的特征是**代理客户端的请求**，通常用于客户端访问外部资源时隐藏客户端的真实IP地址或绕过访问限制

```nginx
server {
    listen 8080;

    location / {
        proxy_pass http://example.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### 用途

* **访问控制**：允许或阻止对**特定**网站的访问
* **缓存**：缓存常用资源提高速度
* **匿名**：隐藏**客户端**的真实ip地址
* **跨域请求**：在开发环境中，前端应用通过正向代理服务器访问后端 API 服务器，以解决跨域问题

### 场景

* **vpn**：国内访问国外特定网站无法直接访问，于是访问中间代理服务器，将访问转发到国外网站
* **devServer中的proxy**：客户端向devServer发请求，devServer将请求转发到目标服务器（如接口api根据路经转发）

## 反向代理

客户端向反向代理服务器发送请求，代理服务器将请求转发给内部服务器。代理的是服务器

### 用途

- **负载均衡**：将请求分发到多台内部服务器以均衡负载
- **安全性**：隐藏内部服务器的真实IP地址，保护内部网络
- **SSL终止**：处理SSL加密，减轻内部服务器的负担。因为加解密流程繁琐，多台服务器浪费资源，因在Nginx层面就处理，不到内部服务器
- **缓存**：Nginx可以返回缓存的数据，不到内部服务器

### 场景

* **负载均衡**

* **本地开发限制**：可能因referrer或cookie等字段，对网站域名有要求，导致本地开发环境localhost可能无法使用。此时可以在本地hosts中配置临时域名，在本地启动一个Nginx代理服务器（满足域名要求），代理服务器通过域名转发访问到本地localhost

## 区别正向代理与反向代理

* **客户端意识**：（需要从客户端视角去理解）
  * 在devserver proxy中，客户端明确知道自己在和开发服务器交互，需要通过开发服务器来访问后端api
  * 如果是nginx中配置了本地host中存在的域名example.com，客户端访问时认为他在和example.com进行交互，而不知道中间存在nginx服务器
* **代理位置**：正向在客户端侧，反向在服务端侧
* **功能分析**：反向代理一般用于用于负载均衡、安全性、或者简化后端服务的访问